# Person Collection Manager (Lab 5-6)

## Описание проекта

**Person Collection Manager** — это клиент-серверное консольное приложение для управления коллекцией объектов `Person`. Проект разработан в рамках лабораторных работ №5 и №6 и демонстрирует продвинутые концепции языка Java, включая:

-   **Клиент-серверную архитектуру:** Четкое разделение логики на сервер, управляющий данными, и клиент для взаимодействия с пользователем.
-   **Неблокирующий ввод-вывод (NIO):** Сервер построен на основе `java.nio.channels` и `Selector`, что позволяет ему обрабатывать множество запросов и консольный ввод в одном потоке без блокировок.
-   **Протокол UDP:** Обмен данными между клиентом и сервером происходит по протоколу UDP.
-   **Сериализация объектов:** Команды и данные передаются в виде сериализованных Java-объектов, а не "сырых" строк.
-   **Многомодульный Maven-проект:** Проект структурирован на три модуля (`common`, `server`, `client`) для лучшей организации и переиспользования кода.
-   **Хранение данных в XML:** Коллекция загружается из XML-файла и сохраняется обратно при помощи технологии JAXB.
-   **Современный Java-код:** Проект использует Stream API и другие возможности Java 17.

Коллекция хранится на сервере в виде `TreeSet`, что обеспечивает автоматическую сортировку элементов по их `id`.

## Структура проекта

Проект состоит из трех Maven-модулей:

-   `common`: Содержит общие классы, используемые как клиентом, так и сервером (модели данных `Person`, `Coordinates` и т.д., а также классы для сетевого взаимодействия `Request`, `Response`).
-   `server`: Серверное приложение. Отвечает за управление коллекцией, работу с файлом и обработку команд от клиентов.
-   `client`: Клиентское приложение. Предоставляет пользователю интерактивную консоль для отправки команд на сервер.

## Функциональность

Приложение поддерживает следующий набор команд:

| Команда                             | Описание                                                                            |
| ----------------------------------- | ----------------------------------------------------------------------------------- |
| `help`                              | Вывести справку по доступным командам.                                              |
| `info`                              | Вывести информацию о коллекции (тип, дата инициализации, количество элементов).     |
| `show`                              | Вывести все элементы коллекции в строковом представлении.                             |
| `add {element}`                     | Добавить новый элемент в коллекцию.                                                 |
| `update id {element}`               | Обновить значение элемента коллекции по его `id`.                                   |
| `remove_by_id id`                   | Удалить элемент из коллекции по его `id`.                                           |
| `clear`                             | Очистить коллекцию.                                                                 |
| `execute_script file_name`          | Считать и исполнить скрипт из указанного файла.                                     |
| `exit`                              | Завершить работу клиента.                                                           |
| `add_if_min {element}`              | Добавить новый элемент, если его значение меньше, чем у наименьшего элемента.       |
| `remove_greater {element}`          | Удалить из коллекции все элементы, превышающие заданный.                            |
| `remove_lower {element}`            | Удалить из коллекции все элементы, меньшие, чем заданный.                           |
| `average_of_height`                 | Вывести среднее значение поля `height` для всех элементов коллекции.                |
| `count_by_hair_color [hairColor]`   | Вывести количество элементов с заданным цветом волос.                               |
| `filter_less_than_hair_color [hairColor]` | Вывести элементы, значение поля `hairColor` которых меньше заданного. |

## Как собрать и запустить

### Требования

-   Java Development Kit (JDK) 17 или выше.
-   Apache Maven 3.6 или выше.

### Сборка

1.  Клонируйте репозиторий:
    ```bash
    git clone <URL вашего репозитория>
    cd <имя папки проекта>
    ```
2.  Соберите проект с помощью Maven. Эта команда создаст исполняемые JAR-файлы в папках `server/target` и `client/target`:
    ```bash
    mvn clean package
    ```

### Запуск

#### 1. Запуск сервера

Для работы сервера необходимо указать **порт** для прослушивания и установить **переменную окружения** `PERSON_COLLECTION_FILE`, указывающую на XML-файл с коллекцией.

**Windows (cmd):**
```bash
set PERSON_COLLECTION_FILE=D:\path\to\your\collection.xml
java -jar server/target/server.jar 8888
```
**Windows (PowerShell):**
```bash
$env:PERSON_COLLECTION_FILE="D:\path\to\your\collection.xml"
java -jar server/target/server.jar 8888
```
***Linux / macOS:***
```bash
export PERSON_COLLECTION_FILE="/path/to/your/collection.xml"
java -jar server/target/server.jar 8888
```
На сервере доступны две команды в консоли:
```bash
save: принудительно сохранить коллекцию в файл.

exit: сохранить коллекцию и завершить работу сервера.
```
***2. Запуск клиента***

Для запуска клиента необходимо указать адрес и порт сервера.

```bash
java -jar client/target/client.jar localhost 8888
```
После запуска клиент перейдет в интерактивный режим, где вы сможете вводить команды из списка выше.

